{
  "hash": "c99233103860e70cce200ee7aab2e515",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Logistic Regression: Model comparison\"\nauthor: \"Prof. Maria Tackett\"\ndate: \"2025-03-27\"\ndate-format: \"MMM DD, YYYY\"\nfooter: \"[ðŸ”— STA 221 - Spring 2025](https://sta221-sp25.netlify.app)\"\nlogo: \"../images/logo.png\"\nformat: \n  revealjs: \n    theme: slides.scss\n    multiplex: false\n    transition: fade\n    slide-number: true\n    incremental: false \n    chalkboard: true\n    include-before: [ '<script type=\"text/x-mathjax-config\">MathJax.Hub.Config({tex2jax: {enableAssistiveMml: false}});</script>']\n  html: \n    output-file: 19-logistic-compare-notes.html\nhtml-math-method:\n  method: mathjax\n  url: \"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"\nexecute:\n  freeze: auto\n  echo: true\nknitr:\n  opts_chunk: \n    R.options:      \n    width: 200\nbibliography: references.bib\n---\n\n\n\n\n\n\n## Announcements\n\n-   Project presentations in March 31 lab\n\n-   Statistics experience due April 15\n\n## Topics\n\nComparing logistic regression models using\n\n-   Drop-in-deviance test\n\n-   AIC\n\n-   BIC\n\n## Computational setup\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# load packages\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(openintro)\nlibrary(knitr)\nlibrary(kableExtra)  # for table embellishments\nlibrary(Stat2Data)   # for empirical logit\n\n# set default theme and larger font size for ggplot2\nggplot2::theme_set(ggplot2::theme_bw(base_size = 20))\n```\n:::\n\n\n\n\n# Data\n\n## Risk of coronary heart disease {.midi}\n\nThis data set is from an ongoing cardiovascular study on residents of the town of Framingham, Massachusetts. We want to examine the relationship between various health characteristics and the risk of having heart disease.\n\n-   `high_risk`:\n\n    -   1: High risk of having heart disease in next 10 years\n    -   0: Not high risk of having heart disease in next 10 years\n\n-   `age`: Age at exam time (in years)\n\n-   `education`: 1 = Some High School, 2 = High School or GED, 3 = Some College or Vocational School, 4 = College\n\n-   `currentSmoker`: 0 = nonsmoker, 1 = smoker\n\n-   `totChol`: Total cholesterol (in mg/dL)\n\n## Data\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4,086 Ã— 6\n     age education TenYearCHD totChol currentSmoker high_risk\n   <dbl> <fct>          <dbl>   <dbl> <fct>         <fct>    \n 1    39 4                  0     195 0             0        \n 2    46 2                  0     250 0             0        \n 3    48 1                  0     245 1             0        \n 4    61 3                  1     225 1             1        \n 5    46 3                  0     285 1             0        \n 6    43 2                  0     228 0             0        \n 7    63 1                  1     205 0             1        \n 8    45 2                  0     313 1             0        \n 9    52 1                  0     260 0             0        \n10    43 1                  0     225 1             0        \n# â„¹ 4,076 more rows\n```\n\n\n:::\n:::\n\n\n\n\n## Modeling risk of coronary heart disease\n\nUsing `age`, `totChol`, and `currentSmoker`\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n\n|term           | estimate| std.error| statistic| p.value| conf.low| conf.high|\n|:--------------|--------:|---------:|---------:|-------:|--------:|---------:|\n|(Intercept)    |   -6.673|     0.378|   -17.647|   0.000|   -7.423|    -5.940|\n|age            |    0.082|     0.006|    14.344|   0.000|    0.071|     0.094|\n|totChol        |    0.002|     0.001|     1.940|   0.052|    0.000|     0.004|\n|currentSmoker1 |    0.443|     0.094|     4.733|   0.000|    0.260|     0.627|\n\n\n:::\n:::\n\n\n\n\n## Review: ROC Curve + Model fit\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhigh_risk_aug <- augment(high_risk_fit)\n\nroc_curve_data <- high_risk_aug |>\n  roc_curve(high_risk, .fitted, event_level = \"second\")\n\n# plot roc curve\nautoplot(roc_curve_data)\n```\n\n::: {.cell-output-display}\n![](19-logistic-compare_files/figure-revealjs/unnamed-chunk-5-1.png){fig-align='center' width=90%}\n:::\n\n```{.r .cell-code}\n#calculate AUC\nhigh_risk_aug |>\n  roc_auc(high_risk, .fitted, event_level = \"second\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 Ã— 3\n  .metric .estimator .estimate\n  <chr>   <chr>          <dbl>\n1 roc_auc binary         0.697\n```\n\n\n:::\n:::\n\n\n\n\n## Review: Classification\n\nWe will use a threshold of 0.2 to classify observations\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n#compute predicted probabilities\npred_prob <- predict.glm(high_risk_fit, type = \"response\")\nhigh_risk_aug <- high_risk_aug |> \n  bind_cols(pred_prob = pred_prob) |>\n  mutate(pred_class = factor(if_else(pred_prob > 0.2, 1, 0)))\n\n# compute confusion matrix\nhigh_risk_aug |>\n  conf_mat(high_risk, pred_class) |>\n  autoplot(type = \"heatmap\")\n```\n\n::: {.cell-output-display}\n![](19-logistic-compare_files/figure-revealjs/unnamed-chunk-6-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\n\n\n## Review: Classification  {.midi}\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](19-logistic-compare_files/figure-revealjs/unnamed-chunk-7-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\n\n\n::: question\n1.  Compute the misclassification rate.\n\n2.  Compute sensitivity and explain what it means in the context of this data.\n\n3.  Compute specificity and explain what it means in the context of this data.\n:::\n\n# Drop-in-deviance test\n\n## Which model do we choose? \n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n\n\n::::: columns\n::: {.column width=\"50%\"}\n<center>**Model 1**</center>\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n\n|term           | estimate|\n|:--------------|--------:|\n|(Intercept)    |   -6.673|\n|age            |    0.082|\n|totChol        |    0.002|\n|currentSmoker1 |    0.443|\n\n\n:::\n:::\n\n\n\n:::\n\n::: {.column width=\"50%\"}\n<center>**Model 2** </center>\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n\n|term           | estimate|\n|:--------------|--------:|\n|(Intercept)    |   -6.456|\n|age            |    0.080|\n|totChol        |    0.002|\n|currentSmoker1 |    0.445|\n|education2     |   -0.270|\n|education3     |   -0.232|\n|education4     |   -0.035|\n\n\n:::\n:::\n\n\n\n:::\n:::::\n\n## Log likelihood\n\n$$\n\\log L = \\sum\\limits_{i=1}^n[y_i \\log(\\hat{p}_i) + (1 - y_i)\\log(1 - \\hat{p}_i)]\n$$\n\n-   Measure of how well the model fits the data\n\n-   Higher values of $\\log L$ are better\n\n-   **Deviance** = $-2 \\log L$\n\n    -   $-2 \\log L$ follows a $\\chi^2$ distribution with $n - p - 1$ degrees of freedom\n\n## Comparing nested models\n\n-   Suppose there are two nested models:\n\n    -   Reduced Model includes predictors $x_1, \\ldots, x_q$\n    -   Full Model includes predictors $x_1, \\ldots, x_q, x_{q+1}, \\ldots, x_p$\n\n-   We want to test the hypotheses\n\n    $$\n    \\begin{aligned}\n    H_0&: \\beta_{q+1} = \\dots = \\beta_p = 0 \\\\\n    H_a&: \\text{ at least one }\\beta_j \\text{ is not } 0\n    \\end{aligned}\n    $$\n\n-   To do so, we will use the **Drop-in-deviance test**, also known as the Nested Likelihood Ratio test\n\n## Drop-in-deviance test\n\n**Hypotheses:**\n\n$$\n\\begin{aligned}\nH_0&: \\beta_{q+1} = \\dots = \\beta_p = 0 \\\\\nH_a&: \\text{ at least one }\\beta_j \\text{ is not } 0\n\\end{aligned}\n$$\n\n. . .\n\n**Test Statistic:** $$\\begin{aligned}G &= \\text{Deviance}_{reduced} - \\text{Deviance}_{full} \\\\\n&= (-2 \\log L_{reduced}) - (-2 \\log L_{full})\\end{aligned}$$\n\n. . .\n\n**P-value:** $P(\\chi^2 > G)$, calculated using a $\\chi^2$ distribution with degrees of freedom equal to the difference in the number of parameters in the full and reduced models\n\n## $\\chi^2$ distribution\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](19-logistic-compare_files/figure-revealjs/unnamed-chunk-11-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\n\n\n## Should we add `education` to the model?\n\nFirst model, reduced:\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhigh_risk_fit_reduced <- glm(high_risk ~ age + totChol + currentSmoker,\n                             data = heart_disease, family = \"binomial\")\n```\n:::\n\n\n\n\n<br>\n\n. . .\n\nSecond model, full:\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-line-numbers=\"3\"}\nhigh_risk_fit_full <- glm(high_risk ~ age + totChol +\n                            currentSmoker + education, \n              data = heart_disease, family = \"binomial\")\n```\n:::\n\n\n\n\n::: question\nWrite the null and alternative hypotheses in words and mathematical notation.\n:::\n\n## Should we add `education` to the model?\n\nCalculate deviance for each model:\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n(dev_reduced <- glance(high_risk_fit_reduced)$deviance)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 3224.812\n```\n\n\n:::\n\n```{.r .cell-code}\n(dev_full <- glance(high_risk_fit_full)$deviance)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 3217.6\n```\n\n\n:::\n:::\n\n\n\n\n. . .\n\nDrop-in-deviance test statistic:\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n(test_stat <- dev_reduced - dev_full)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 7.212113\n```\n\n\n:::\n:::\n\n\n\n\n## Should we add `education` to the model?\n\nCalculate the p-value using a `pchisq()`, with degrees of freedom equal to the number of new model terms in the second model:\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npchisq(test_stat, 3, lower.tail = FALSE) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.06543567\n```\n\n\n:::\n:::\n\n\n\n\n<br>\n\n. . .\n\n::: question\nWhat is your conclusion?\n:::\n\n## Drop-in-Deviance test in R {.midi}\n\n-   We can use the **`anova`** function to conduct this test\n\n-   Add **`test = \"Chisq\"`** to conduct the drop-in-deviance test\n\n. . .\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nanova(high_risk_fit_reduced, high_risk_fit_full, test = \"Chisq\") |>\n  tidy() |> kable(digits = 3)\n```\n\n::: {.cell-output-display}\n\n\n|term                                                  | df.residual| residual.deviance| df| deviance| p.value|\n|:-----------------------------------------------------|-----------:|-----------------:|--:|--------:|-------:|\n|high_risk ~ age + totChol + currentSmoker             |        4082|          3224.812| NA|       NA|      NA|\n|high_risk ~ age + totChol + currentSmoker + education |        4079|          3217.600|  3|    7.212|   0.065|\n\n\n:::\n:::\n\n\n\n\n# Model selection using AIC and BIC\n\n## AIC & BIC\n\nEstimators of prediction error and *relative* quality of models:\n\n. . .\n\n**Akaike's Information Criterion (AIC)**[^1]: $$AIC = -2\\log L + 2(p+1)$$\n\n[^1]: Akaike, Hirotugu. [\"A new look at the statistical model identification.\"](https://ieeexplore.ieee.org/stamp/stamp.jsp?tp=&arnumber=1100705) *IEEE transactions on automatic control* 19.6 (1974): 716-723.\n\n. . .\n\n**Schwarz's Bayesian Information Criterion (BIC)**[^2]: $$ BIC = -2\\log L + \\log(n)\\times(p+1)$$\n\n[^2]: Schwarz, Gideon. [\"Estimating the dimension of a model.\"](https://projecteuclid.org/journalArticle/Download?urlId=10.1214%2Faos%2F1176344136) *The annals of statistics* (1978): 461-464.\n\n## AIC & BIC\n\n$$\n\\begin{aligned} \n& AIC = \\color{blue}{-2\\log L}  \\color{black}{+ 2(p+1)} \\\\\n& BIC = \\color{blue}{-2\\log L}  + \\color{black}{\\log(n)\\times(p+1)}\n\\end{aligned}\n$$\n\n. . .\n\n<br>\n\nFirst Term: Decreases as *p* increases\n\n## AIC & BIC\n\n$$\n\\begin{aligned} & AIC = -2\\log L  + \\color{blue}{2(p+1)} \\\\\n& BIC = -2\\log L + \\color{blue}{\\log(n)\\times(p+1)} \n\\end{aligned}\n$$\n\n<br>\n\nSecond term: Increases as *p* increases\n\n## Using AIC & BIC\n\n$$\n\\begin{aligned} & AIC = -2\\log L  + \\color{red}{2(p+1)} \\\\\n& BIC = -2 \\log L  + \\color{red}{\\log(n)\\times(p+1)} \n\\end{aligned}\n$$\n\n-   Choose model with the smaller value of AIC or BIC\n\n-   If $n \\geq 8$, the **penalty** for BIC is larger than that of AIC, so BIC tends to favor *more parsimonious* models (i.e. models with fewer terms)\n\n## AIC from the `glance()` function\n\nLet's look at the AIC for the model that includes `age`, `totChol`, and `currentSmoker`\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nglance(high_risk_fit)$AIC\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 3232.812\n```\n\n\n:::\n:::\n\n\n\n\n<br>\n\n. . .\n\n**Calculating AIC**\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n- 2 * glance(high_risk_fit)$logLik + 2 * (3 + 1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 3232.812\n```\n\n\n:::\n:::\n\n\n\n\n## Comparing the models using AIC\n\nLet's compare the full and reduced models using AIC.\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nglance(high_risk_fit_reduced)$AIC\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 3232.812\n```\n\n\n:::\n\n```{.r .cell-code}\nglance(high_risk_fit_full)$AIC\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 3231.6\n```\n\n\n:::\n:::\n\n\n\n\n<br>\n\n::: question\nBased on AIC, which model would you choose?\n:::\n\n## Comparing the models using BIC\n\nLet's compare the full and reduced models using BIC\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nglance(high_risk_fit_reduced)$BIC\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 3258.074\n```\n\n\n:::\n\n```{.r .cell-code}\nglance(high_risk_fit_full)$BIC\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 3275.807\n```\n\n\n:::\n:::\n\n\n\n\n<br>\n\n::: question\nBased on BIC, which model would you choose?\n:::\n\n# Application exercise\n\n::: appex\nðŸ“‹ [sta210-sp25.netlify.app/ae/ae-10-logistic-compare.html](../ae/ae-10-logistic-compare.html)\n:::\n",
    "supporting": [
      "19-logistic-compare_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}