{
  "hash": "2b295c9cd8f927434d2d0a018b8c11eb",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Model evaluation\"\nauthor: \"Prof. Maria Tackett\"\ndate: \"2025-02-04\"\ndate-format: \"MMM DD, YYYY\"\nfooter: \"[üîó STA 210 - Spring 2025](https://sta210-sp25.netlify.app)\"\nlogo: \"../images/logo.png\"\nformat: \n  revealjs: \n    theme: slides.scss\n    multiplex: false\n    transition: fade\n    slide-number: true\n    incremental: false \n    chalkboard: true\n    include-before: [ '<script type=\"text/x-mathjax-config\">MathJax.Hub.Config({tex2jax: {enableAssistiveMml: false}});</script>']\n  html: \n    output-file: 08-model-eval-notes.html\nhtml-math-method:\n  method: mathjax\n  url: \"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"\nexecute:\n  freeze: auto\n  echo: true\nknitr:\n  opts_chunk: \n    R.options:      \n    width: 200\nbibliography: references.bib\n---\n\n\n\n\n\n\n## Announcements\n\n-   Lab 02 due Thursday at 11:59pm\n\n-   HW 02 released later today\n\n-   [Click here](https://prodduke.sharepoint.com/:p:/s/ARCStaff839/EZ4PKTRTlCVMpFZiR6XoRycB4UUlRMuI2_Rda9hKxNZtsA) to learn more about the Academic Resource Center\n\n-   [Statistics experience](../hw/stats-experience.html) due Tuesday, April 15\n\n## Office hours poll\n\n<!--# ADD this-->\n\n## Topics\n\n::: nonincremental\n-   Recap of MLR and predictor types\n-   Interaction terms\n-   ANOVA and sum of squares\n-   $R^2$ and RMSE\n-   Adjusted $R^2$\n-   Comparing models with $R^2$ vs. $R^2_{adj}$\n:::\n\n## Computational setup\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# load packages\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(patchwork)\nlibrary(knitr)\nlibrary(kableExtra)\nlibrary(colorblindr)\n\n# set default theme and larger font size for ggplot2\nggplot2::theme_set(ggplot2::theme_bw(base_size = 20))\n```\n:::\n\n\n\n\n# Recap: Multiple linear regression\n\n## Data: Palmer penguins {.midi}\n\nThe `penguins` data set contains data for penguins found on three islands in the Palmer Archipelago, Antarctica. Data were collected and made available by [Dr.¬†Kristen Gorman](https://www.uaf.edu/cfos/people/faculty/detail/kristen-gorman.php) and the [Palmer Station, Antarctica LTER](https://pal.lternet.edu/), a member of the [Long Term Ecological Research Network](https://lternet.edu/). These data can be found in the **palmerpenguins** R package.\n\n. . .\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 342 √ó 4\n   body_mass_g flipper_length_mm bill_length_mm species\n         <int>             <int>          <dbl> <fct>  \n 1        3750               181           39.1 Adelie \n 2        3800               186           39.5 Adelie \n 3        3250               195           40.3 Adelie \n 4        3450               193           36.7 Adelie \n 5        3650               190           39.3 Adelie \n 6        3625               181           38.9 Adelie \n 7        4675               195           39.2 Adelie \n 8        3475               193           34.1 Adelie \n 9        4250               190           42   Adelie \n10        3300               186           37.8 Adelie \n# ‚Ñπ 332 more rows\n```\n\n\n:::\n:::\n\n\n\n\n## Variables\n\n**Predictors**:\n\n-   `bill_length_mm`: Bill length in millimeters\n-   `flipper_length_mm`: Flipper length in millimeters\n-   `species`: Adelie, Gentoo, or Chinstrap species\n\n**Response**: `body_mass_g`: Body mass in grams\n\n<br>\n\n**The goal of this analysis is to use the bill length, flipper length, and species to predict body mass.**\n\n## Response vs. predictors {.small}\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](08-model-eval_files/figure-revealjs/unnamed-chunk-4-1.png){fig-align='center' width=3000}\n:::\n:::\n\n\n\n\n## Model fit\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npenguin_fit <- lm(body_mass_g ~ flipper_length_mm + species + \n                bill_length_mm, data = penguins)\n\ntidy(penguin_fit) |>\n  kable(digits = 3)\n```\n\n::: {.cell-output-display}\n\n\n|term              |  estimate| std.error| statistic| p.value|\n|:-----------------|---------:|---------:|---------:|-------:|\n|(Intercept)       | -3904.387|   529.257|    -7.377|   0.000|\n|flipper_length_mm |    27.429|     3.176|     8.638|   0.000|\n|speciesChinstrap  |  -748.562|    81.534|    -9.181|   0.000|\n|speciesGentoo     |    90.435|    88.647|     1.020|   0.308|\n|bill_length_mm    |    61.736|     7.126|     8.664|   0.000|\n\n\n:::\n:::\n\n\n\n\n## Interpreting $\\hat{\\beta}_j$\n\n-   The estimated coefficient $\\hat{\\beta}_j$ is the expected change in the mean of $Y$ when $X_j$ increases by one unit, <i>holding the values of all other predictor variables constant</i>.\n\n. . .\n\n-   **Example:** The estimated coefficient for `flipper_length_mm` is 27.429. This means for each additional millimeter in a penguin's flipper length, its body mass is expected to be greater by 27.429 grams, on average, *holding species and bill length constant.*\n\n## Indicator variables\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n   <th style=\"text-align:right;\"> conf.low </th>\n   <th style=\"text-align:right;\"> conf.high </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> -3904.387 </td>\n   <td style=\"text-align:right;\"> 529.257 </td>\n   <td style=\"text-align:right;\"> -7.377 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> -4945.450 </td>\n   <td style=\"text-align:right;\"> -2863.324 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> flipper_length_mm </td>\n   <td style=\"text-align:right;\"> 27.429 </td>\n   <td style=\"text-align:right;\"> 3.176 </td>\n   <td style=\"text-align:right;\"> 8.638 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 21.182 </td>\n   <td style=\"text-align:right;\"> 33.675 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;background-color: rgba(220, 229, 178, 255) !important;\"> speciesChinstrap </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> -748.562 </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> 81.534 </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> -9.181 </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> 0.000 </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> -908.943 </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> -588.182 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;background-color: rgba(220, 229, 178, 255) !important;\"> speciesGentoo </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> 90.435 </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> 88.647 </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> 1.020 </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> 0.308 </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> -83.937 </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> 264.807 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> bill_length_mm </td>\n   <td style=\"text-align:right;\"> 61.736 </td>\n   <td style=\"text-align:right;\"> 7.126 </td>\n   <td style=\"text-align:right;\"> 8.664 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 47.720 </td>\n   <td style=\"text-align:right;\"> 75.753 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n<br>\n\n::: question\nInterpret the coefficient of `Gentoo` in the context of the data.\n:::\n\n## Centering {.midi}\n\n-   Centering a quantitative predictor means shifting every value by some constant $C$\n\n$$\nX_{cent} = X  - C\n$$\n\n-   One common type of centering is **mean-centering**, in which every value of a predictor is shifted by its mean\n\n-   Only quantitative predictors are centered\n\n-   Center all quantitative predictors in the model for ease of interpretation\n\n::: question\nHow does centering change the model and/or interpretations?\n:::\n\n## Standardizing {.midi}\n\n-   Standardizing a quantitative predictor mean shifting every value by the mean and dividing by the standard deviation of that variable\n\n$$\nX_{std} = \\frac{X - \\bar{X}}{S_X}\n$$\n\n-   Only quantitative predictors are standardized\n\n-   Standardize all quantitative predictors in the model for ease of interpretation\n\n::: question\nHow does standardizing change the model and/or interpretations?\n:::\n\n# Interaction terms\n\n## Interaction terms\n\n-   Sometimes the relationship between a predictor variable and the response depends on the value of another predictor variable.\n-   This is an **interaction effect**.\n-   To account for this, we can include **interaction terms** in the model.\n\n## Bill length versus species\n\nIf the lines are not parallel, there is indication of a potential **interaction effect**, i.e., the slope of bill length may differ based on the species.\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](08-model-eval_files/figure-revealjs/unnamed-chunk-7-1.png){fig-align='center' width=3000}\n:::\n:::\n\n\n\n\n## Interaction term in model {.smaller}\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npenguin_int_fit <- lm(body_mass_g ~ flipper_length_mm + species + bill_length_mm + species * bill_length_mm,\n      data = penguins)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> -4297.905 </td>\n   <td style=\"text-align:right;\"> 645.054 </td>\n   <td style=\"text-align:right;\"> -6.663 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> flipper_length_mm </td>\n   <td style=\"text-align:right;\"> 27.263 </td>\n   <td style=\"text-align:right;\"> 3.175 </td>\n   <td style=\"text-align:right;\"> 8.586 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> speciesChinstrap </td>\n   <td style=\"text-align:right;\"> 1146.287 </td>\n   <td style=\"text-align:right;\"> 726.217 </td>\n   <td style=\"text-align:right;\"> 1.578 </td>\n   <td style=\"text-align:right;\"> 0.115 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> speciesGentoo </td>\n   <td style=\"text-align:right;\"> 54.716 </td>\n   <td style=\"text-align:right;\"> 619.934 </td>\n   <td style=\"text-align:right;\"> 0.088 </td>\n   <td style=\"text-align:right;\"> 0.930 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> bill_length_mm </td>\n   <td style=\"text-align:right;\"> 72.692 </td>\n   <td style=\"text-align:right;\"> 10.642 </td>\n   <td style=\"text-align:right;\"> 6.831 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;background-color: rgba(220, 229, 178, 255) !important;\"> speciesChinstrap:bill_length_mm </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> -41.035 </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> 16.104 </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> -2.548 </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> 0.011 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;background-color: rgba(220, 229, 178, 255) !important;\"> speciesGentoo:bill_length_mm </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> -1.163 </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> 14.436 </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> -0.081 </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> 0.936 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n## Interaction terms in the model\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> -4297.905 </td>\n   <td style=\"text-align:right;\"> 645.054 </td>\n   <td style=\"text-align:right;\"> -6.663 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> flipper_length_mm </td>\n   <td style=\"text-align:right;\"> 27.263 </td>\n   <td style=\"text-align:right;\"> 3.175 </td>\n   <td style=\"text-align:right;\"> 8.586 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> speciesChinstrap </td>\n   <td style=\"text-align:right;\"> 1146.287 </td>\n   <td style=\"text-align:right;\"> 726.217 </td>\n   <td style=\"text-align:right;\"> 1.578 </td>\n   <td style=\"text-align:right;\"> 0.115 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> speciesGentoo </td>\n   <td style=\"text-align:right;\"> 54.716 </td>\n   <td style=\"text-align:right;\"> 619.934 </td>\n   <td style=\"text-align:right;\"> 0.088 </td>\n   <td style=\"text-align:right;\"> 0.930 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> bill_length_mm </td>\n   <td style=\"text-align:right;\"> 72.692 </td>\n   <td style=\"text-align:right;\"> 10.642 </td>\n   <td style=\"text-align:right;\"> 6.831 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;background-color: rgba(220, 229, 178, 255) !important;\"> speciesChinstrap:bill_length_mm </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> -41.035 </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> 16.104 </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> -2.548 </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> 0.011 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;background-color: rgba(220, 229, 178, 255) !important;\"> speciesGentoo:bill_length_mm </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> -1.163 </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> 14.436 </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> -0.081 </td>\n   <td style=\"text-align:right;background-color: rgba(220, 229, 178, 255) !important;\"> 0.936 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n<br>\n\n::: question\n-   Write the model equation for penguins in the Adelie species.\n-   Write the model equation for penguins in the Chinstrap species.\n:::\n\n## Interpreting interaction terms\n\n-   What the interaction means: The effect of bill length on the body mass is 41.035 less when the penguin is from the Chinstrap species compared to the effect for the Adelie species, holding all else constant.\n-   Interpreting `bill_length_mm` for Chinstrap: For each additional millimeter in bill length, we expect the body mass of Chinstrap penguins to increase by 31.657 grams (72.692 - 41.035), holding all else constant.\n\n## Summary\n\n<br>\n\n::: question\nIn general, how do\n\nindicators for categorical predictors impact the model equation?\n\ninteraction terms impact the model equation?\n:::\n\n# Model evaluation\n\n## Data: Restaurant tips\n\nWhich variables help us predict the amount customers tip at a restaurant? To answer this question, we will use data collected in 2011 by a student at St. Olaf who worked at a local restaurant.\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 169 √ó 4\n     Tip Party Meal   Age   \n   <dbl> <dbl> <chr>  <chr> \n 1  2.99     1 Dinner Yadult\n 2  2        1 Dinner Yadult\n 3  5        1 Dinner SenCit\n 4  4        3 Dinner Middle\n 5 10.3      2 Dinner SenCit\n 6  4.85     2 Dinner Middle\n 7  5        4 Dinner Yadult\n 8  4        3 Dinner Middle\n 9  5        2 Dinner Middle\n10  1.58     1 Dinner SenCit\n# ‚Ñπ 159 more rows\n```\n\n\n:::\n:::\n\n\n\n\n:::: aside\n::: small\nDahlquist, Samantha, and Jin Dong. 2011. ‚ÄúThe Effects of Credit Cards on Tipping.‚Äù Project for Statistics 212-Statistics for the Sciences, St. Olaf College\n:::\n::::\n\n## Variables\n\n**Predictors**:\n\n::: nonincremental\n-   `Party`: Number of people in the party\n-   `Meal`: Time of day (Lunch, Dinner, Late Night)\n-   `Age`: Age category of person paying the bill (Yadult, Middle, SenCit)\n:::\n\n**Response**: `Tip`: Amount of tip\n\n## Response: `Tip`\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](08-model-eval_files/figure-revealjs/unnamed-chunk-13-1.png){fig-align='center' width=3000}\n:::\n:::\n\n\n\n\n## Predictors\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](08-model-eval_files/figure-revealjs/unnamed-chunk-14-1.png){fig-align='center' width=3000}\n:::\n:::\n\n\n\n\n## Relevel categorical predictors\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntips <- tips |>\n  mutate(\n    Meal = fct_relevel(Meal, \"Lunch\", \"Dinner\", \"Late Night\"),\n    Age  = fct_relevel(Age, \"Yadult\", \"Middle\", \"SenCit\")\n  )\n```\n:::\n\n\n\n\n## Predictors, again\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](08-model-eval_files/figure-revealjs/unnamed-chunk-16-1.png){fig-align='center' width=3000}\n:::\n:::\n\n\n\n\n## Response vs. predictors\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](08-model-eval_files/figure-revealjs/unnamed-chunk-17-1.png){fig-align='center' width=3600}\n:::\n:::\n\n\n\n\n## Fit and summarize model {.midi}\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntip_fit <- linear_reg() |>\n  set_engine(\"lm\") |>\n  fit(Tip ~ Party + Age, data = tips)\n\ntidy(tip_fit) |>\n  kable(digits = 3)\n```\n\n::: {.cell-output-display}\n\n\n|term        | estimate| std.error| statistic| p.value|\n|:-----------|--------:|---------:|---------:|-------:|\n|(Intercept) |   -0.170|     0.366|    -0.465|   0.643|\n|Party       |    1.837|     0.124|    14.758|   0.000|\n|AgeMiddle   |    1.009|     0.408|     2.475|   0.014|\n|AgeSenCit   |    1.388|     0.485|     2.862|   0.005|\n\n\n:::\n:::\n\n\n\n\n. . .\n\n<br>\n\n::: question\nOverall, how well does this model help us understand variablility n tips?\n:::\n\n## Two statistics\n\n-   **Root mean square error, RMSE**: A measure of the average error (average difference between observed and predicted values of the outcome)\n\n-   **R-squared**, $R^2$ : Percentage of variability in the outcome explained by the regression model (in the context of SLR, the predictor)\n\n::: question\nWhat indicates a good model fit? Higher or lower RMSE? Higher or lower $R^2$?\n:::\n\n## RMSE\n\n$$\nRMSE = \\sqrt{\\frac{\\sum_{i=1}^n(y_i - \\hat{y}_i)^2}{n}} = \\sqrt{\\frac{\\sum_{i=1}^ne_i^2}{n}}\n$$\n\n. . .\n\n::: incremental\n-   Ranges between 0 (perfect predictor) and infinity (terrible predictor)\n\n-   Same units as the response variable\n\n-   The value of RMSE is more useful for comparing across models than evaluating a single model\n:::\n\n# Analysis of variance (ANOVA)\n\n## Analysis of variance (ANOVA)\n\n**Analysis of Variance (ANOVA)**: Technique to partition variability in Y by the sources of variability\n\n![](images/clipboard-3964457409-01.png)\n\n## ANOVA\n\n-   **Main Idea:** Decompose the total variation in the response into\n    -   the variation that can be explained by the each of the variables in the model\n\n    -   the variation that **can't** be explained by the model (left in the residuals)\n-   If the variation that can be explained by the variables in the model is greater than the variation in the residuals, this signals that the model might be \"valuable\" (at least one of the $\\beta$'s not equal to 0)\n\n## Sum of Squares\n\n<br>\n\n$$\n\\begin{aligned}\n\\color{#407E99}{SST} \\hspace{5mm}&= &\\color{#993399}{SSM} &\\hspace{5mm} +  &\\color{#8BB174}{SSR} \\\\[10pt]\n\\color{#407E99}{\\sum_{i=1}^n(y_i - \\bar{y})^2} \\hspace{5mm}&= &\\color{#993399}{\\sum_{i = 1}^{n}(\\hat{y}_i - \\bar{y})^2} &\\hspace{5mm}+ &\\color{#8BB174}{\\sum_{i = 1}^{n}(y_i - \\hat{y}_i)^2}\n\\end{aligned}\n$$\n\n::: aside\n[Click here](https://introregression.netlify.app/98-appendix#sum-of-squares) to see why this equality holds.\n:::\n\n## ANOVA output in R[^1]\n\n[^1]: [Click here](anova-table.html) for explanation about the way R calculates sum of squares for each variable.\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nanova(tip_fit$fit) |>\n  tidy() |>\n  kable(digits = 2)\n```\n\n::: {.cell-output-display}\n\n\n|term      |  df|   sumsq|  meansq| statistic| p.value|\n|:---------|---:|-------:|-------:|---------:|-------:|\n|Party     |   1| 1188.64| 1188.64|    285.71|    0.00|\n|Age       |   2|   38.03|   19.01|      4.57|    0.01|\n|Residuals | 165|  686.44|    4.16|        NA|      NA|\n\n\n:::\n:::\n\n\n\n\n## ANOVA output, with totals\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n\n|term      |  df|   sumsq|meansq  |statistic |p.value |\n|:---------|---:|-------:|:-------|:---------|:-------|\n|Party     |   1| 1188.64|1188.64 |285.71    |0       |\n|Age       |   2|   38.03|19.01   |4.57      |0.01    |\n|Residuals | 165|  686.44|4.16    |          |        |\n|Total     | 168| 1913.11|        |          |        |\n\n\n:::\n:::\n\n\n\n\n## Sum of squares\n\n::::: columns\n::: {.column width=\"50%\"}\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> df </th>\n   <th style=\"text-align:right;\"> sumsq </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Party </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 1188.64 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Age </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 38.03 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Residuals </td>\n   <td style=\"text-align:right;\"> 165 </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 686.44 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Total </td>\n   <td style=\"text-align:right;\"> 168 </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 1913.11 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n:::\n\n::: {.column width=\"50%\"}\n-   $SST$: Total sum of squares, variability of Response, $\\sum_{i = 1}^n (y_i - \\bar{y})^2$\n-   $SSR$: Residual sum of squares, variability of residuals, $\\sum_{i = 1}^n (y_i - \\hat{y}_i)^2$\n-   $SSM = SST - SSR$: Model sum of squares, variability explained by the model\n:::\n:::::\n\n## Sum of squares: $SST$\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> df </th>\n   <th style=\"text-align:right;\"> sumsq </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Party </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1188.64 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Age </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 38.03 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Residuals </td>\n   <td style=\"text-align:right;\"> 165 </td>\n   <td style=\"text-align:right;\"> 686.44 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;background-color: rgba(217, 227, 228, 255) !important;\"> Total </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 168 </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 1913.11 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n<br>\n\n<center>\n\n$SST$: Total sum of squares, variability of the response\n\n<br>\n\n$\\sum_{i = 1}^n (y_i - \\bar{y})^2$ = 1913.11\n\n</center>\n\n## Sum of squares: $SSR$\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> df </th>\n   <th style=\"text-align:right;\"> sumsq </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Party </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1188.64 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Age </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 38.03 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;background-color: rgba(217, 227, 228, 255) !important;\"> Residuals </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 165 </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 686.44 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Total </td>\n   <td style=\"text-align:right;\"> 168 </td>\n   <td style=\"text-align:right;\"> 1913.11 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n<br>\n\n<center>\n\n$SSR$: Residual sum of squares, variability of residuals\n\n<br>\n\n$\\sum_{i = 1}^n (y_i - \\hat{y}_i)^2$ = 686.44\n\n</center>\n\n## Sum of squares: $SSM$\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> df </th>\n   <th style=\"text-align:right;\"> sumsq </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;background-color: rgba(217, 227, 228, 255) !important;\"> Party </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 1 </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 1188.64 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;background-color: rgba(217, 227, 228, 255) !important;\"> Age </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 2 </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 38.03 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Residuals </td>\n   <td style=\"text-align:right;\"> 165 </td>\n   <td style=\"text-align:right;\"> 686.44 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Total </td>\n   <td style=\"text-align:right;\"> 168 </td>\n   <td style=\"text-align:right;\"> 1913.11 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n<br>\n\n<center>\n\n$SSM$: Variability explained by the model\n\n<br>\n\n$SST - SSR$ = 1226.67\n\n</center>\n\n## R-squared, $R^2$\n\nThe **coefficient of determination** $R^2$ is the proportion of variation in the response, \\$Y\\$, that is explained by the regression model\n\n. . .\n\n$$\nR^2 = \\frac{SSM}{SST} = 1 - \\frac{SSR}{SST} = 1 - \\frac{686.44}{1913.11} = 0.641\n$$\n\n. . .\n\n::: question\nWhat is the range of $R^2$ Does $R^2$ have units?\n:::\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nglance(tip_fit)$r.squared\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.6411891\n```\n\n\n:::\n:::\n\n\n\n\n## Interpreting $R^2$ \n\n# Application exercise? \n",
    "supporting": [
      "08-model-eval_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}